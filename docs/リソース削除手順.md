# Google Cloud リソース削除手順（難易度別）

このドキュメントでは、デプロイしたリソースを削除（クリーンアップ）する手順を、手軽さと影響範囲に応じた3つの難易度レベルで解説します。

## 難易度選択

| 難易度 | 手法 | 特徴 | 推奨シーン |
| :--- | :--- | :--- | :--- |
| **【初級】** | **スクリプト実行** | **簡単・高速**。主な課金リソース（Cloud Run, Image）を削除。 | 一時的に停止したい、作り直したい場合。 |
| **【中級】** | **手動完全クリーンアップ** | **中程度**。スクリプトが残したログやビルドキャッシュも削除。 | 将来再利用するが、ディスク容量なども綺麗にしたい場合。 |
| **【上級】** | **プロジェクト削除** | **危険・確実**。プロジェクトごと全て消去。復元不可。 | 完全に開発を終了する場合。 |

---

## 【初級】スクリプトによる自動削除 (Easy)

最も手軽な方法です。用意されたスクリプトを実行するだけで、ランニングコストがかかる主要なリソースを削除します。

### 手順

ターミナルで `backend` ディレクトリに移動し、`destroy.sh` を実行します。

```bash
cd backend
./destroy.sh
```

### 削除されるもの

* Cloud Run サービス (`ptera-backend`)
* Container Registry / Artifact Registry のコンテナイメージ (`gcr.io/ptera-481818/ptera-backend`)

### 注意点

* Cloud Build のビルドログや、ビルド時に作成された一時的な Storage バケットは残ります（これらは微量ですがストレージ容量を使用します）。

---

## 【中級】残存アーティファクトの手動削除 (Normal)

「初級」に加え、ビルドプロセスで生成されたゴミ（アーティファクト）やログ、未使用のストレージバケットを削除し、プロジェクトを「デプロイ前」の状態に近づけます。

### 手順

**1. Cloud Build イメージの残りカスを削除**
Cloud Build はビルド時にソースコードを Cloud Storage に一時保存します。これを削除します。

```bash
# バケット一覧を確認
gcloud storage ls

# Cloud Build 用のバケット（*_cloudbuild など）を削除
gcloud storage rm --recursive gs://[PROJECT_ID]_cloudbuild/
```

**2. 未使用のイメージタグを徹底的に削除**
スクリプトで消しきれなかった古いバージョンのイメージがある場合、コンソールまたは以下のコマンドで確認・削除します。

```bash
gcloud container images list-tags gcr.io/[PROJECT_ID]/ptera-backend
```

---

## 【上級】プロジェクト削除 (Hard)

**⚠️ 警告: この操作は取り消せません。**
プロジェクトに含まれるすべてのリソース（Firestore のデータ、IAM設定、API有効化状態など全て）が完全に削除されます。

### 手順

プロジェクトIDを指定して、プロジェクトそのものをシャットダウンします。

```bash
# プロジェクトIDを確認
echo $GOOGLE_CLOUD_PROJECT

# プロジェクトを削除
gcloud projects delete [PROJECT_ID]
```

### 削除されるもの

* **全て**

---

## 補足: フロントエンドの設定解除

リソースを削除した場合、フロントエンド (`front/.env.local`) の接続先設定も不要になります。

1. `front/.env.local` を開く。
2. `BACKEND_URL` の行を削除またはコメントアウトする。
