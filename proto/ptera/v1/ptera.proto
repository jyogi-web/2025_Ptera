syntax = "proto3";

package ptera.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/jyogi-web/2025_Ptera/backend/pkg/grpc/ptera/v1;ptera";

service PteraService {
  // CompleteCard は画像URLと任意の部分情報を受け取り、
  // AIを使用してカード情報を自動補完します。
  rpc CompleteCard(CompleteCardRequest) returns (CompleteCardResponse);
}

service BattleService {
  rpc StartBattle(StartBattleRequest) returns (BattleState);
  rpc Attack(AttackRequest) returns (BattleState);
  rpc Retreat(RetreatRequest) returns (BattleState);
}

message User {
  string id = 1;
  string name = 2;
  string icon_url = 3;
  optional string email = 4;
  optional string circle_id = 5;
}

message Card {
  string id = 1;
  string creator_id = 2;
  string name = 3;
  int32 grade = 4;
  string position = 5;
  optional string affiliated_group = 6;
  string hobby = 7;
  string description = 8;
  string image_url = 9;
  google.protobuf.Timestamp created_at = 10;
  optional string circle_id = 11;
  // Battle Stats
  int32 max_hp = 12;
  int32 attack = 13;
  string flavor = 14;
  int32 current_hp = 15; // バトル中の現在HP
}

message Circle {
  string id = 1;
  string name = 2;
}

message CompleteCardRequest {
  string image_url = 1; // 画像URL
  optional string name = 2; // 既存の名前
  optional string faculty = 3; // 既存の学部
  optional string department = 4; // 既存の学科
  optional int32 grade = 5; // 既存の学年
  optional string position = 6; // 既存の職位
  optional string hobby = 7; // 既存の趣味
  optional string description = 8; // 既存の説明文
}

message CompleteCardResponse {
  string name = 1; // 補完された名前
  string faculty = 2; // 補完された学部
  string department = 3; // 補完された学科
  int32 grade = 4; // 補完された学年
  string position = 5; // 補完された職位
  string hobby = 6; // 補完された趣味
  string description = 7; // 補完された説明文
  bool success = 8; // 補完が成功したかどうかを示すフラグ
  optional string error_message = 9; // エラーメッセージ（存在する場合）
}

// --- Battle Messages ---

message BattleState {
  string battle_id = 1;
  Player player_me = 2; // リクエストしたプレイヤー（自分）
  Player player_opponent = 3; // 対戦相手
  int32 current_turn = 4;
  string current_player_id = 5; // ターンプレイヤーのID
  string winner_id = 6; // 勝者のID ("" なら対戦中)
  repeated string logs = 7;
}

message Player {
  string player_id = 1;
  string circle_id = 2;
  string circle_name = 3;
  int32 hp = 4; // プレイヤーHP
  repeated Card deck = 5; // [0] is active, [1..] are bench
}

message StartBattleRequest {
  string my_circle_id = 1;
  string opponent_circle_id = 2;
}

message AttackRequest {
  string battle_id = 1;
  string player_id = 2; // 認証情報から取るべきだが、一旦IDを送る
}

message RetreatRequest {
  string battle_id = 1;
  string player_id = 2;
  int32 bench_index = 3;
}
